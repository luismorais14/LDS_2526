    <form [formGroup]="form" (ngSubmit)="publicarAnuncio()" class="min-vh-100 py-5" style="background-color: #ecf2f3;">
        <div class="container">
            <div class="bg-white p-5 p-xl-6 rounded-4 shadow-lg mx-auto" style="max-width: 1100px;">


                <div class="d-flex justify-content-start mb-4">
                    <button
                        mat-flat-button
                        color="accent"
                        [routerLink]="['/']"
                        class="rounded-pill px-4 py-2 d-flex align-items-center gap-2 shadow-sm"
                    >
                        <mat-icon>arrow_back</mat-icon>
                        <span class="fw-bold">Voltar</span>
                    </button>
                </div>

                <header class="mb-5">
                    <h1 class="fw-bold display-5 mb-2" style="color:#0f4c4c;">Publica o teu livro</h1>
                    <p class="text-muted fs-5">Cria o teu anúncio em poucos passos</p>
                </header>

                <!-- Upload Fotos -->
                <section>
                    <label class="border border-3 border-secondary border-opacity-25 rounded-4 p-5 bg-light w-100
                        d-flex flex-column justify-content-center align-items-center"
                        style="border-style: dashed; cursor: pointer;">

                        <mat-icon style="font-size: 4rem; width: 4rem; height: 4rem; color:#0f4c4c;">cloud_upload</mat-icon>
                        <p class="mt-3 fs-4 fw-semibold text-center">Carregar Imagens</p>

                    <input type="file"
                        data-testid="input-imagens"
                        class="d-none"
                        multiple accept="image/*"
                        (change)="onImagensSelecionadas($event)">
                    </label>

                    <div class="row g-3 mt-3">
                        <div class="col-auto" *ngFor="let img of previewImagens; let i = index">
                            <div class="position-relative" style="width: 140px; height: 180px;">

                                <img [src]="img"
                                    class="img-fluid rounded border border-2"
                                    style="width: 100%; height: 100%; object-fit: cover;">


                                <button type="button"
                                        class="btn btn-light btn-sm position-absolute d-flex justify-content-center align-items-center"
                                        style="top: 4px; right: 4px; width: 24px; height: 24px; padding: 0;"
                                        (click)="removerImagem(i)">

                                        <mat-icon fontIcon="close"></mat-icon>
                                </button>

                            </div>
                        </div>
                    </div>

                    <small *ngIf="erroImagem" class="text-danger ms-1">
                        {{ erroImagem }}
                    </small>
                </section>

                <!-- ISBN -->
                <div class="mb-3 mt-3">
                    <label class="form-label">ISBN do Livro</label>

                    <input type="text"
                        data-testid="isbn-input"
                        class="form-control"
                        formControlName="isbn"
                        placeholder="9783161484100"
                        (input)="validarISBN()">

                    <div class="form-text">
                        As informações do livro serão preenchidas automaticamente a partir do ISBN.
                    </div>

                    <small *ngIf="erroIsbn" class="text-danger">{{ erroIsbn }}</small>
                </div>

                <!-- Preenchidos automaticamente -->
                <fieldset disabled>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nome do Livro</label>
                            <input type="text" class="form-control"
                                formControlName="titulo"
                                placeholder="Será preenchido automaticamente" readonly>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">Autor</label>
                            <input type="text" class="form-control"
                                formControlName="autor"
                                placeholder="Será preenchido automaticamente" readonly>
                        </div>
                    </div>
                </fieldset>

                <!-- Restantes campos -->
                <div class="row mt-3">

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Categoria</label>
                        <select class="form-select"
                                data-testid="categoria-select"
                                formControlName="categoriaId">
                            <option disabled selected value="">Seleciona uma categoria</option>
                            <option *ngFor="let c of categorias" [value]="c.id">{{ c.nome }}</option>
                        </select>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Estado do Livro</label>
                        <select class="form-select"
                                data-testid="estado-select"
                                formControlName="estadoLivro">
                            <option disabled selected value="">Seleciona um estado</option>
                            <option value="NOVO">Novo</option>
                            <option value="COMO_NOVO">Como Novo</option>
                            <option value="USADO">Usado</option>
                            <option value="DANIFICADO">Danificado</option>
                        </select>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Tipo de Anúncio</label>
                        <select class="form-select"
                                data-testid="tipo-select"
                                formControlName="tipoAnuncio">
                            <option disabled selected value="">Seleciona um tipo</option>
                            <option value="VENDA">Venda</option>
                            <option value="ALUGUER">Aluguer</option>
                            <option value="DOACAO">Doação</option>
                        </select>
                    </div>

                    <div class="col-md-6 mb-3" *ngIf="form.get('tipoAnuncio')?.value !== 'DOACAO'">
                        <label class="form-label">Preço (€)</label>

                        <div class="input-group">
                            <span class="input-group-text">€</span>
                            <input type="number"
                                data-testid="preco-input"
                                formControlName="preco"
                                class="form-control"
                                placeholder="Ex: 7.50"
                                min="0"
                                step="0.01"
                                >
                        </div>

                        <small *ngIf="form.get('preco')?.touched && form.get('preco')?.errors?.['min']"
                            class="text-danger">
                             O preço deve ser maior que 0 €.
                        </small>

                        <small *ngIf="form.get('preco')?.touched && form.get('preco')?.errors?.['max']"
                            class="text-danger">
                            O preço deve ser inferior a 10.000€.
                        </small>


                    </div>
                </div>

                <!-- Submit -->
                <button type="submit" class="btn btn-success btn-lg px-5" [disabled]="form.invalid" data-testid="publicar-btn">
                    Publicar anúncio
                </button>

            </div>
        </div>
    </form>
