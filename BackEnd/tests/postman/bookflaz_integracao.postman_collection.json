{
	"info": {
		"_postman_id": "14e320ca-1497-462d-9d3c-ed9652731b6d",
		"name": "BookFlaz – Integração",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "49194894",
		"_collection_link": "https://josemiguelrocha2005-9905909.postman.co/workspace/Jose-Rocha's-Workspace~b5909890-efe1-49d5-86b9-522e1cf8e660/collection/49194894-14e320ca-1497-462d-9d3c-ed9652731b6d?action=share&source=collection_link&creator=49194894"
	},
	"item": [
		{
			"name": "FluxoUtilizador",
			"item": [
				{
					"name": "RegistarUtilizador",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar utilizador: 200/201\", () => {\r",
									"  pm.expect(pm.response.code).to.be.oneOf([200, 201]);\r",
									"});\r",
									"\r",
									"const bodyText = pm.response.text();\r",
									"pm.test(\"Mensagem contém 'criado com sucesso'\", () => {\r",
									"  pm.expect(bodyText.toLowerCase()).to.include(\"criado com sucesso\");\r",
									"});\r",
									"\r",
									"try {\r",
									"  const j = JSON.parse(pm.variables.replaceIn(pm.request.body.raw || \"{}\"));\r",
									"  if (j.email)        pm.environment.set(\"email\", j.email);\r",
									"  if (j.passwordHash) pm.environment.set(\"passwordHash\", j.passwordHash);\r",
									"} catch (e) {}\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"nome\": \"Miguel\",\r\n  \"email\": \"miguel+{{$timestamp}}@example.com\",\r\n  \"passwordHash\": \"teste\",\r\n  \"telefone\": \"910198088\",\r\n  \"dob\": \"2005-11-04T14:38:40.109Z\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Cliente/Registar",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Cliente",
								"Registar"
							]
						}
					},
					"response": []
				},
				{
					"name": "LoginUtilizador",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Login 200 OK\", () => pm.response.to.have.status(200));\r",
									"\r",
									"const j = pm.response.json();\r",
									"\r",
									"pm.test(\"Resposta tem token\", () => {\r",
									"  pm.expect(j).to.have.property(\"token\");\r",
									"  pm.expect(j.token).to.be.a(\"string\").and.not.empty;\r",
									"});\r",
									"\r",
									"pm.environment.set(\"TOKEN\", j.token);\r",
									"\r",
									"function parseJwt(token) {\r",
									"  try {\r",
									"    const base64Url = token.split('.')[1];\r",
									"    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r",
									"    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {\r",
									"      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\r",
									"    }).join(''));\r",
									"    return JSON.parse(jsonPayload);\r",
									"  } catch (e) {\r",
									"    console.error(\"Erro a decodificar JWT:\", e);\r",
									"    return null;\r",
									"  }\r",
									"}\r",
									"\r",
									"const decoded = parseJwt(j.token);\r",
									"\r",
									"if (decoded) {\r",
									"  const userId = decoded[\"nameid\"] || decoded[\"sub\"] || decoded[\"id\"];\r",
									"  if (userId) {\r",
									"    pm.environment.set(\"USER_ID\", userId);\r",
									"    console.log(\"ID do utilizador guardado:\", userId);\r",
									"  } else {\r",
									"    console.warn(\"Claim de ID não encontrada no token:\", decoded);\r",
									"  }\r",
									"}\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{email}}\",\r\n  \"passwordHash\": \"{{passwordHash}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Cliente/Login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Cliente",
								"Login"
							]
						}
					},
					"response": []
				},
				{
					"name": "VerPerfil",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/perfil/{{USER_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"perfil",
								"{{USER_ID}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "EditarUtilizador",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"nome\": \"Miguel\",\r\n  \"email\": \"testeParaOZe@example.com\",\r\n  \"passwordHash\": \"string\",\r\n  \"telefone\": \"111222333\",\r\n  \"dob\": \"2000-11-07T19:34:58.920Z\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Cliente/editar/{{USER_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Cliente",
								"editar",
								"{{USER_ID}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "ApagarUtilizador",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/Cliente/eliminar/{{USER_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Cliente",
								"eliminar",
								"{{USER_ID}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Auth",
			"item": [
				{
					"name": "CriarCliente",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar utilizador: 200/201\", () => {\r",
									"  pm.expect(pm.response.code).to.be.oneOf([200, 201]);\r",
									"});\r",
									"\r",
									"const bodyText = pm.response.text();\r",
									"pm.test(\"Mensagem contém 'criado com sucesso'\", () => {\r",
									"  pm.expect(bodyText.toLowerCase()).to.include(\"criado com sucesso\");\r",
									"});\r",
									"\r",
									"try {\r",
									"  const j = JSON.parse(pm.variables.replaceIn(pm.request.body.raw || \"{}\"));\r",
									"  if (j.email)        pm.environment.set(\"email\", j.email);\r",
									"  if (j.passwordHash) pm.environment.set(\"passwordHash\", j.passwordHash);\r",
									"} catch (e) {}\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"nome\": \"Miguel\",\r\n  \"email\": \"miguel+{{$timestamp}}@example.com\",\r\n  \"passwordHash\": \"teste\",\r\n  \"telefone\": \"910198088\",\r\n  \"dob\": \"2005-11-04T14:38:40.109Z\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Cliente/Registar",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Cliente",
								"Registar"
							]
						}
					},
					"response": []
				},
				{
					"name": "LoginCliente",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Login 200 OK\", () => pm.response.to.have.status(200));\r",
									"\r",
									"const j = pm.response.json();\r",
									"\r",
									"pm.test(\"Resposta tem token\", () => {\r",
									"  pm.expect(j).to.have.property(\"token\");\r",
									"  pm.expect(j.token).to.be.a(\"string\").and.not.empty;\r",
									"});\r",
									"\r",
									"pm.environment.set(\"TOKEN\", j.token);\r",
									"\r",
									"function parseJwt(token) {\r",
									"  try {\r",
									"    const base64Url = token.split('.')[1];\r",
									"    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r",
									"    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {\r",
									"      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\r",
									"    }).join(''));\r",
									"    return JSON.parse(jsonPayload);\r",
									"  } catch (e) {\r",
									"    console.error(\"Erro a decodificar JWT:\", e);\r",
									"    return null;\r",
									"  }\r",
									"}\r",
									"\r",
									"const decoded = parseJwt(j.token);\r",
									"\r",
									"if (decoded) {\r",
									"  const userId = decoded[\"nameid\"] || decoded[\"sub\"] || decoded[\"id\"];\r",
									"  if (userId) {\r",
									"    pm.environment.set(\"USER_ID\", userId);\r",
									"    console.log(\"ID do utilizador guardado:\", userId);\r",
									"  } else {\r",
									"    console.warn(\"Claim de ID não encontrada no token:\", decoded);\r",
									"  }\r",
									"}\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{email}}\",\r\n  \"passwordHash\": \"{{passwordHash}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Cliente/Login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Cliente",
								"Login"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Categoria",
			"item": [
				{
					"name": "LoginComAdmin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Login 200 OK\", () => pm.response.to.have.status(200));\r",
									"\r",
									"const j = pm.response.json();\r",
									"\r",
									"pm.test(\"Resposta tem token\", () => {\r",
									"  pm.expect(j).to.have.property(\"token\");\r",
									"  pm.expect(j.token).to.be.a(\"string\").and.not.empty;\r",
									"});\r",
									"\r",
									"pm.environment.set(\"TokenAdmin\", j.token);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('AdminEmail:', pm.environment.get('AdminEmail'));\r",
									"console.log('AdminPass:', pm.environment.get('AdminPass'));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{AdminEmail}}\",\r\n  \"passwordHash\": \"{{AdminPass}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Cliente/Login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Cliente",
								"Login"
							]
						}
					},
					"response": []
				},
				{
					"name": "CriarCategoria",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"const j = pm.response.json();\r",
									"\r",
									"pm.environment.set(\"CategoriaId\", String(j.id));\r",
									"pm.environment.set(\"CategoriaNome\", j.nome);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"function randLetters(n) {\r",
									"  const letters = 'abcdefghijklmnopqrstuvwxyz';\r",
									"  let s = '';\r",
									"  for (let i = 0; i < n; i++) s += letters[Math.floor(Math.random()*letters.length)];\r",
									"  return s;\r",
									"}\r",
									"\r",
									"const categoriaNome = `Ciencia${randLetters(6)}`; \r",
									"\r",
									"pm.environment.set(\"CategoriaNome\", categoriaNome);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TokenAdmin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"nome\": \"{{CategoriaNome}}\",\r\n  \"ativo\": true\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Categoria",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Categoria"
							]
						}
					},
					"response": []
				},
				{
					"name": "EditarCategoria",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Atualizar categoria: 200/204\", () => {\r",
									"  pm.expect(pm.response.code).to.be.oneOf([200, 204]);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"function randLetters(n) {\r",
									"  const letters = 'abcdefghijklmnopqrstuvwxyz';\r",
									"  let s = '';\r",
									"  for (let i = 0; i < n; i++) s += letters[Math.floor(Math.random()*letters.length)];\r",
									"  return s;\r",
									"}\r",
									"\r",
									"const categoriaNome = `Ciencia${randLetters(6)}`; \r",
									"\r",
									"pm.environment.set(\"CategoriaNome\", categoriaNome);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TokenAdmin}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"nome\": \"{{CategoriaNome}}\",\r\n  \"ativo\": true\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Categoria/{{CategoriaId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Categoria",
								"{{CategoriaId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "ObterCategorias",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.response.to.have.status(200));\r",
									"\r",
									"pm.test(\"Content-Type JSON\", () =>\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\") || \"\").to.include(\"json\")\r",
									");"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TokenAdmin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"nome\": \"NomeAtualizado\",\r\n  \"ativo\": true\r\n}\r\n"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Categoria/categorias",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Categoria",
								"categorias"
							]
						}
					},
					"response": []
				},
				{
					"name": "ObterCategoriasAtiva",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.response.to.have.status(200));\r",
									"\r",
									"pm.test(\"Content-Type JSON\", () =>\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\") || \"\").to.include(\"json\")\r",
									");"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TokenAdmin}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"nome\": \"NomeAtualizado\",\r\n  \"ativo\": true\r\n}\r\n"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Categoria/categorias/disponiveis",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Categoria",
								"categorias",
								"disponiveis"
							]
						}
					},
					"response": []
				},
				{
					"name": "CriarCategoriaParaApagar",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"function randLetters(n) {\r",
									"  const letters = 'abcdefghijklmnopqrstuvwxyz';\r",
									"  let s = '';\r",
									"  for (let i = 0; i < n; i++) s += letters[Math.floor(Math.random()*letters.length)];\r",
									"  return s;\r",
									"}\r",
									"\r",
									"const categoriaNome = `Ciencia${randLetters(6)}`; \r",
									"\r",
									"pm.environment.set(\"CategoriaNome2\", categoriaNome);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"const j = pm.response.json();\r",
									"\r",
									"pm.environment.set(\"CategoriaId2\", String(j.id));\r",
									"pm.environment.set(\"CategoriaNome2\", j.nome);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TokenAdmin}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"nome\": \"{{CategoriaNome2}}\",\r\n  \"ativo\": true\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Categoria",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Categoria"
							]
						}
					},
					"response": []
				},
				{
					"name": "CategoriaApagar",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TokenAdmin}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/Categoria/{{CategoriaId2}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Categoria",
								"{{CategoriaId2}}"
							]
						}
					},
					"response": []
				}
			],
			"auth": {
				"type": "noauth"
			},
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Anuncio",
			"item": [
				{
					"name": "CriarAnuncio",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar anúncio 200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));",
									"",
									"const f = pm.request.body.formdata?.all?.() || [];",
									"const isbn = (f.find(x => x.key === \"LivroIsbn\") || {}).value || pm.environment.get(\"LivroIsbn\");",
									"",
									"pm.environment.set(\"LivroIsbn\", String(isbn)); ",
									"",
									"pm.sendRequest({",
									"  url: `${pm.environment.get(\"baseUrl\")}/api/Anuncio?livroIsbn=${encodeURIComponent(isbn)}`,",
									"  method: \"GET\",",
									"  header: { Authorization: `Bearer ${pm.environment.get(\"TOKEN\") || \"\"}` }",
									"}, (_, res) => {",
									"  const list = (res.json().anuncios || res.json() || []);",
									"  list.sort((a,b) => (Date.parse(b.dataCriacao||0) - Date.parse(a.dataCriacao||0)) || ((b.id||0) - (a.id||0)));",
									"  pm.environment.set(\"AnuncioId\", String(list[0]?.id || \"\"));",
									"});",
									"",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "Preco",
									"value": "40",
									"type": "text"
								},
								{
									"key": "LivroIsbn",
									"value": "9788869183157",
									"type": "text"
								},
								{
									"key": "CategoriaId",
									"value": "{{CategoriaId}}",
									"type": "text"
								},
								{
									"key": "EstadoLivro",
									"value": "NOVO",
									"type": "text"
								},
								{
									"key": "TipoAnuncio",
									"value": "VENDA",
									"type": "text"
								},
								{
									"key": "Imagens",
									"type": "file",
									"src": [
										"tests/postman/assets/book.jpeg",
										"tests/postman/assets/book.jpeg"
									]
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Anuncio",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Anuncio"
							]
						}
					},
					"response": []
				},
				{
					"name": "ListarAnuncios",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.expect(pm.response.code).to.equal(200));\r",
									"\r",
									"pm.test(\"Content-Type JSON\", () => {\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\") || \"\")\r",
									"    .to.match(/application\\/json/i);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "PrecoMaximo",
								"value": "20",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "Preco",
									"value": "40",
									"type": "text"
								},
								{
									"key": "LivroIsbn",
									"value": "9788869183157",
									"type": "text"
								},
								{
									"key": "CategoriaId",
									"value": "{{CategoriaId}}",
									"type": "text"
								},
								{
									"key": "EstadoLivro",
									"value": "NOVO",
									"type": "text"
								},
								{
									"key": "TipoAnuncio",
									"value": "VENDA",
									"type": "text"
								},
								{
									"key": "Imagens",
									"type": "file",
									"src": [
										"tests/postman/assets/book.jpeg",
										"tests/postman/assets/book.jpeg"
									]
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Anuncio?{{LivroIsbn}}\n\n",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Anuncio"
							],
							"query": [
								{
									"key": "{{LivroIsbn}}\n\n",
									"value": null
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "AtualizarAnuncio",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/204 OK\", () => pm.expect([200,204]).to.include(pm.response.code));\r",
									"\r",
									"const j = pm.response.json();\r",
									"msg = j.message || j.Message || \"\";\r",
									"\r",
									"pm.test(`\"Anúncio atualizado com sucesso.\"`, () => {\r",
									"  pm.expect(msg).to.eql(\"Anúncio atualizado com sucesso.\");\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "Preco",
									"value": "40",
									"type": "text"
								},
								{
									"key": "LivroIsbn",
									"value": "9788869183157",
									"type": "text"
								},
								{
									"key": "CategoriaId",
									"value": "{{CategoriaId}}",
									"type": "text"
								},
								{
									"key": "EstadoLivro",
									"value": "NOVO",
									"type": "text"
								},
								{
									"key": "TipoAnuncio",
									"value": "VENDA",
									"type": "text"
								},
								{
									"key": "Imagens",
									"type": "file",
									"src": [
										"tests/postman/assets/book.jpeg",
										"tests/postman/assets/book.jpeg"
									],
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Anuncio/{{AnuncioId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Anuncio",
								"{{AnuncioId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "ApagarAnuncio",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.expect(pm.response.code).to.equal(200));\r",
									"\r",
									"\r",
									"const j = pm.response.json();\r",
									"msg = j.message || j.Message || \"\";\r",
									"\r",
									"pm.test('\"Anúncio removido com sucesso.\"', () => {\r",
									"  pm.expect(msg).to.eql(\"Anúncio removido com sucesso.\");\r",
									"});\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "Preco",
									"value": "40",
									"type": "text"
								},
								{
									"key": "LivroIsbn",
									"value": "9788869183157",
									"type": "text"
								},
								{
									"key": "CategoriaId",
									"value": "{{CategoriaId}}",
									"type": "text"
								},
								{
									"key": "EstadoLivro",
									"value": "NOVO",
									"type": "text"
								},
								{
									"key": "TipoAnuncio",
									"value": "VENDA",
									"type": "text"
								},
								{
									"key": "Imagens",
									"type": "file",
									"src": [
										"tests/postman/assets/book.jpeg",
										"tests/postman/assets/book.jpeg"
									],
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Anuncio/{{AnuncioId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Anuncio",
								"{{AnuncioId}}"
							]
						}
					},
					"response": []
				}
			],
			"auth": {
				"type": "bearer",
				"bearer": [
					{
						"key": "token",
						"value": "{{TOKEN}}",
						"type": "string"
					}
				]
			},
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Favoritos",
			"item": [
				{
					"name": "NovoCliente",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"try {\r",
									"  const j = JSON.parse(pm.variables.replaceIn(pm.request.body.raw || \"{}\"));\r",
									"  if (j.email)        pm.environment.set(\"email2\", j.email);\r",
									"  if (j.passwordHash) pm.environment.set(\"passwordHash2\", j.passwordHash);\r",
									"} catch (e) {}\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"nome\": \"Miguel\",\r\n  \"email\": \"miguel+{{$timestamp}}@example.com\",\r\n  \"passwordHash\": \"teste\",\r\n  \"telefone\": \"910198088\",\r\n  \"dob\": \"2005-11-04T14:38:40.109Z\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Cliente/Registar",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Cliente",
								"Registar"
							]
						}
					},
					"response": []
				},
				{
					"name": "LoginNovoCliente",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Login 200 OK\", () => pm.response.to.have.status(200));\r",
									"\r",
									"const j = pm.response.json();\r",
									"\r",
									"pm.test(\"Resposta tem token\", () => {\r",
									"  pm.expect(j).to.have.property(\"token\");\r",
									"  pm.expect(j.token).to.be.a(\"string\").and.not.empty;\r",
									"});\r",
									"\r",
									"pm.environment.set(\"TOKEN2\", j.token);\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"email\": \"{{email2}}\",\r\n  \"passwordHash\": \"{{passwordHash2}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Cliente/Login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Cliente",
								"Login"
							]
						}
					},
					"response": []
				},
				{
					"name": "CriarAnuncioCliente2",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar anúncio 200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"const f = pm.request.body.formdata?.all?.() || [];\r",
									"const isbn = (f.find(x => x.key === \"LivroIsbn\") || {}).value || pm.environment.get(\"LivroIsbn\");\r",
									"\r",
									"pm.environment.set(\"LivroIsbn\", String(isbn)); \r",
									"\r",
									"pm.sendRequest({\r",
									"  url: `${pm.environment.get(\"baseUrl\")}/api/Anuncio?livroIsbn=${encodeURIComponent(isbn)}`,\r",
									"  method: \"GET\",\r",
									"  header: { Authorization: `Bearer ${pm.environment.get(\"TOKEN\") || \"\"}` }\r",
									"}, (_, res) => {\r",
									"  const list = (res.json().anuncios || res.json() || []);\r",
									"  list.sort((a,b) => (Date.parse(b.dataCriacao||0) - Date.parse(a.dataCriacao||0)) || ((b.id||0) - (a.id||0)));\r",
									"  pm.environment.set(\"AnuncioId\", String(list[0]?.id || \"\"));\r",
									"});\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "Preco",
									"value": "40",
									"type": "text"
								},
								{
									"key": "LivroIsbn",
									"value": "9788869183157",
									"type": "text"
								},
								{
									"key": "CategoriaId",
									"value": "{{CategoriaId}}",
									"type": "text"
								},
								{
									"key": "EstadoLivro",
									"value": "NOVO",
									"type": "text"
								},
								{
									"key": "TipoAnuncio",
									"value": "VENDA",
									"type": "text"
								},
								{
									"key": "Imagens",
									"type": "file",
									"src": "tests/postman/assets/book.jpeg"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Anuncio",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Anuncio"
							]
						}
					},
					"response": []
				},
				{
					"name": "AdicionarFavorito",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.response.to.have.status(200));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "Preco",
									"value": "40",
									"type": "text"
								},
								{
									"key": "LivroIsbn",
									"value": "9788869183157",
									"type": "text"
								},
								{
									"key": "CategoriaId",
									"value": "{{CategoriaId}}",
									"type": "text"
								},
								{
									"key": "EstadoLivro",
									"value": "NOVO",
									"type": "text"
								},
								{
									"key": "TipoAnuncio",
									"value": "VENDA",
									"type": "text"
								},
								{
									"key": "Imagens",
									"type": "file",
									"src": "tests/postman/assets/book.jpeg"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Favorito?idAnuncio={{AnuncioId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Favorito"
							],
							"query": [
								{
									"key": "idAnuncio",
									"value": "{{AnuncioId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "VerFavoritos",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.response.to.have.status(200));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "Preco",
									"value": "40",
									"type": "text"
								},
								{
									"key": "LivroIsbn",
									"value": "9788869183157",
									"type": "text"
								},
								{
									"key": "CategoriaId",
									"value": "{{CategoriaId}}",
									"type": "text"
								},
								{
									"key": "EstadoLivro",
									"value": "NOVO",
									"type": "text"
								},
								{
									"key": "TipoAnuncio",
									"value": "VENDA",
									"type": "text"
								},
								{
									"key": "Imagens",
									"type": "file",
									"src": "tests/postman/assets/book.jpeg"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Favorito",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Favorito"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Pedidos",
			"item": [
				{
					"name": "NovoPedidoTransacao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let j = {};\r",
									"try { j = pm.response.json(); } catch (e) { j = {}; }\r",
									"\r",
									"const setVar = (k, v) => {\r",
									"  pm.environment.set(k, v);\r",
									"  pm.collectionVariables.set(k, v);\r",
									"};\r",
									"\r",
									"if (j.pedidoId != null)   setVar(\"PedidoId\",   String(j.pedidoId));\r",
									"if (j.conversaId != null) setVar(\"ConversaId\", String(j.conversaId));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"valorProposto\": \"30\",\r\n    \"anuncioId\": {{AnuncioId}}\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/PedidoTransacao",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"PedidoTransacao"
							]
						}
					},
					"response": []
				},
				{
					"name": "AceitarPedidoTransacao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.expect(pm.response.code).to.equal(200));\r",
									"\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"valorProposto\": \"30\",\r\n    \"anuncioId\": {{AnuncioId}}\r\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/PedidoTransacao/{{PedidoId}}/aceitar",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"PedidoTransacao",
								"{{PedidoId}}",
								"aceitar"
							]
						}
					},
					"response": []
				},
				{
					"name": "NovoAnuncioParaRejeitar",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar anúncio 200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"const f = pm.request.body.formdata?.all?.() || [];\r",
									"const isbn = (f.find(x => x.key === \"LivroIsbn\") || {}).value || pm.environment.get(\"LivroIsbn\");\r",
									"\r",
									"pm.environment.set(\"LivroIsbn\", String(isbn)); \r",
									"\r",
									"pm.sendRequest({\r",
									"  url: `${pm.environment.get(\"baseUrl\")}/api/Anuncio?livroIsbn=${encodeURIComponent(isbn)}`,\r",
									"  method: \"GET\",\r",
									"  header: { Authorization: `Bearer ${pm.environment.get(\"TOKEN\") || \"\"}` }\r",
									"}, (_, res) => {\r",
									"  const list = (res.json().anuncios || res.json() || []);\r",
									"  list.sort((a,b) => (Date.parse(b.dataCriacao||0) - Date.parse(a.dataCriacao||0)) || ((b.id||0) - (a.id||0)));\r",
									"  pm.environment.set(\"AnuncioId\", String(list[0]?.id || \"\"));\r",
									"});\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "Preco",
									"value": "40",
									"type": "text"
								},
								{
									"key": "LivroIsbn",
									"value": "9788869183157",
									"type": "text"
								},
								{
									"key": "CategoriaId",
									"value": "{{CategoriaId}}",
									"type": "text"
								},
								{
									"key": "EstadoLivro",
									"value": "NOVO",
									"type": "text"
								},
								{
									"key": "TipoAnuncio",
									"value": "VENDA",
									"type": "text"
								},
								{
									"key": "Imagens",
									"type": "file",
									"src": "tests/postman/assets/book.jpeg"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Anuncio",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Anuncio"
							]
						}
					},
					"response": []
				},
				{
					"name": "PedidoTransacaoParaRejeitar",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let j = {};\r",
									"try { j = pm.response.json(); } catch (e) { j = {}; }\r",
									"\r",
									"const setVar = (k, v) => {\r",
									"  pm.environment.set(k, v);\r",
									"  pm.collectionVariables.set(k, v);\r",
									"};\r",
									"\r",
									"if (j.pedidoId != null)   setVar(\"PedidoId\",   String(j.pedidoId));\r",
									"if (j.conversaId != null) setVar(\"ConversaId\", String(j.conversaId));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"valorProposto\": \"30\",\r\n    \"anuncioId\": {{AnuncioId}}\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/PedidoTransacao",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"PedidoTransacao"
							]
						}
					},
					"response": []
				},
				{
					"name": "RejeitarPedidoTransacao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.expect(pm.response.code).to.equal(200));\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/PedidoTransacao/{{PedidoId}}/rejeitar",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"PedidoTransacao",
								"{{PedidoId}}",
								"rejeitar"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Pontos",
			"item": [
				{
					"name": "VerPontos",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.expect(pm.response.code).to.equal(200));\r",
									"\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Pontos",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Pontos"
							]
						}
					},
					"response": []
				},
				{
					"name": "VerHistoricoPontos",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 404 (sem histórico de pontos)\", () => {\r",
									"  pm.response.to.have.status(404);\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/Pontos/Historico",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Pontos",
								"Historico"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "FluxoAceitarTransacaoEConfirmarRececao",
			"item": [
				{
					"name": "CriarAnuncioVenda",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar anúncio 200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"const f = pm.request.body.formdata?.all?.() || [];\r",
									"const isbn = (f.find(x => x.key === \"LivroIsbn\") || {}).value || pm.environment.get(\"LivroIsbn\");\r",
									"\r",
									"pm.environment.set(\"LivroIsbn\", String(isbn)); \r",
									"\r",
									"pm.sendRequest({\r",
									"  url: `${pm.environment.get(\"baseUrl\")}/api/Anuncio?livroIsbn=${encodeURIComponent(isbn)}`,\r",
									"  method: \"GET\",\r",
									"  header: { Authorization: `Bearer ${pm.environment.get(\"TOKEN\") || \"\"}` }\r",
									"}, (_, res) => {\r",
									"  const list = (res.json().anuncios || res.json() || []);\r",
									"  list.sort((a,b) => (Date.parse(b.dataCriacao||0) - Date.parse(a.dataCriacao||0)) || ((b.id||0) - (a.id||0)));\r",
									"  pm.environment.set(\"AnuncioId\", String(list[0]?.id || \"\"));\r",
									"});\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "Preco",
									"value": "40",
									"type": "text"
								},
								{
									"key": "LivroIsbn",
									"value": "9788869183157",
									"type": "text"
								},
								{
									"key": "CategoriaId",
									"value": "{{CategoriaId}}",
									"type": "text"
								},
								{
									"key": "EstadoLivro",
									"value": "NOVO",
									"type": "text"
								},
								{
									"key": "TipoAnuncio",
									"value": "VENDA",
									"type": "text"
								},
								{
									"key": "Imagens",
									"type": "file",
									"src": "tests/postman/assets/book.jpeg"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Anuncio",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Anuncio"
							]
						}
					},
					"response": []
				},
				{
					"name": "PedidoTransacao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let j = {};\r",
									"try { j = pm.response.json(); } catch (e) { j = {}; }\r",
									"\r",
									"const setVar = (k, v) => {\r",
									"  pm.environment.set(k, v);\r",
									"  pm.collectionVariables.set(k, v);\r",
									"};\r",
									"\r",
									"if (j.pedidoId != null)   setVar(\"PedidoId\",   String(j.pedidoId));\r",
									"if (j.conversaId != null) setVar(\"ConversaId\", String(j.conversaId));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"valorProposto\": \"30\",\r\n    \"anuncioId\": {{AnuncioId}}\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/PedidoTransacao",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"PedidoTransacao"
							]
						}
					},
					"response": []
				},
				{
					"name": "AceitarPedido",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.expect(pm.response.code).to.equal(200));\r",
									"\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"valorProposto\": \"30\",\r\n    \"anuncioId\": {{AnuncioId}}\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/PedidoTransacao/{{PedidoId}}/aceitar",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"PedidoTransacao",
								"{{PedidoId}}",
								"aceitar"
							]
						}
					},
					"response": []
				},
				{
					"name": "CriarTransacao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar transação 200/201\", () => {\r",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);\r",
									"});\r",
									"\r",
									"const transacao = pm.response.json().transacao;\r",
									"pm.environment.set(\"TransacaoId\", transacao.id);\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"pedidoId\": {{PedidoId}},\r\n    \"pontosUsados\": 0\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Transacao",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Transacao"
							]
						}
					},
					"response": []
				},
				{
					"name": "ConfirmarRececao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar anúncio 200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"pedidoId\": {{PedidoId}},\r\n    \"pontosUsados\": 0\r\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Transacao/confirmar-rececao-comprador/{{TransacaoId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Transacao",
								"confirmar-rececao-comprador",
								"{{TransacaoId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Avaliacao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 200 OK\", () => {\r",
									"    pm.response.to.have.status(200);\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"estrelas\" : 3,\r\n    \"comentario\": \"foi top\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Avaliacao/transacoes/{{TransacaoId}}/avaliacoes?avaliadoId={{USER_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Avaliacao",
								"transacoes",
								"{{TransacaoId}}",
								"avaliacoes"
							],
							"query": [
								{
									"key": "avaliadoId",
									"value": "{{USER_ID}}"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "FluxoAceitarTransacaoCancelar",
			"item": [
				{
					"name": "CriarAnuncioValido",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar anúncio 200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"const f = pm.request.body.formdata?.all?.() || [];\r",
									"const isbn = (f.find(x => x.key === \"LivroIsbn\") || {}).value || pm.environment.get(\"LivroIsbn\");\r",
									"\r",
									"pm.environment.set(\"LivroIsbn\", String(isbn)); \r",
									"\r",
									"pm.sendRequest({\r",
									"  url: `${pm.environment.get(\"baseUrl\")}/api/Anuncio?livroIsbn=${encodeURIComponent(isbn)}`,\r",
									"  method: \"GET\",\r",
									"  header: { Authorization: `Bearer ${pm.environment.get(\"TOKEN\") || \"\"}` }\r",
									"}, (_, res) => {\r",
									"  const list = (res.json().anuncios || res.json() || []);\r",
									"  list.sort((a,b) => (Date.parse(b.dataCriacao||0) - Date.parse(a.dataCriacao||0)) || ((b.id||0) - (a.id||0)));\r",
									"  pm.environment.set(\"AnuncioId\", String(list[0]?.id || \"\"));\r",
									"});\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "Preco",
									"value": "40",
									"type": "text"
								},
								{
									"key": "LivroIsbn",
									"value": "9788869183157",
									"type": "text"
								},
								{
									"key": "CategoriaId",
									"value": "{{CategoriaId}}",
									"type": "text"
								},
								{
									"key": "EstadoLivro",
									"value": "NOVO",
									"type": "text"
								},
								{
									"key": "TipoAnuncio",
									"value": "ALUGUER",
									"type": "text"
								},
								{
									"key": "Imagens",
									"type": "file",
									"src": "tests/postman/assets/book.jpeg"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Anuncio",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Anuncio"
							]
						}
					},
					"response": []
				},
				{
					"name": "PedidoTransacao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let j = {};\r",
									"try { j = pm.response.json(); } catch (e) { j = {}; }\r",
									"\r",
									"const setVar = (k, v) => {\r",
									"  pm.environment.set(k, v);\r",
									"  pm.collectionVariables.set(k, v);\r",
									"};\r",
									"\r",
									"if (j.pedidoId != null)   setVar(\"PedidoId\",   String(j.pedidoId));\r",
									"if (j.conversaId != null) setVar(\"ConversaId\", String(j.conversaId));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"valorProposto\": \"30\",\r\n    \"anuncioId\": {{AnuncioId}},\r\n    \"diasDeAluguel\": 20\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/PedidoTransacao",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"PedidoTransacao"
							]
						}
					},
					"response": []
				},
				{
					"name": "AceitarPedido",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.expect(pm.response.code).to.equal(200));\r",
									"\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"valorProposto\": \"30\",\r\n    \"anuncioId\": {{AnuncioId}}\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/PedidoTransacao/{{PedidoId}}/aceitar",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"PedidoTransacao",
								"{{PedidoId}}",
								"aceitar"
							]
						}
					},
					"response": []
				},
				{
					"name": "CriarTransacao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar transação 200/201\", () => {\r",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);\r",
									"});\r",
									"\r",
									"const transacao = pm.response.json().transacao;\r",
									"pm.environment.set(\"TransacaoId\", transacao.id);\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"pedidoId\": {{PedidoId}},\r\n    \"pontosUsados\": 0\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Transacao",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Transacao"
							]
						}
					},
					"response": []
				},
				{
					"name": "CancelarTransacao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.expect(pm.response.code).to.equal(200));\r",
									"\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"pedidoId\": {{PedidoId}},\r\n    \"pontosUsados\": 0\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Transacao/cancelar/{{TransacaoId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Transacao",
								"cancelar",
								"{{TransacaoId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "HistoricoTransacao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.expect(pm.response.code).to.equal(200));\r",
									"\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"pedidoId\": {{PedidoId}},\r\n    \"pontosUsados\": 0\r\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Transacao/registo",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Transacao",
								"registo"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "FluxoTransacaoEhDevolucao",
			"item": [
				{
					"name": "CriarAnuncioAluguer",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar anúncio 200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"const f = pm.request.body.formdata?.all?.() || [];\r",
									"const isbn = (f.find(x => x.key === \"LivroIsbn\") || {}).value || pm.environment.get(\"LivroIsbn\");\r",
									"\r",
									"pm.environment.set(\"LivroIsbn\", String(isbn)); \r",
									"\r",
									"pm.sendRequest({\r",
									"  url: `${pm.environment.get(\"baseUrl\")}/api/Anuncio?livroIsbn=${encodeURIComponent(isbn)}`,\r",
									"  method: \"GET\",\r",
									"  header: { Authorization: `Bearer ${pm.environment.get(\"TOKEN\") || \"\"}` }\r",
									"}, (_, res) => {\r",
									"  const list = (res.json().anuncios || res.json() || []);\r",
									"  list.sort((a,b) => (Date.parse(b.dataCriacao||0) - Date.parse(a.dataCriacao||0)) || ((b.id||0) - (a.id||0)));\r",
									"  pm.environment.set(\"AnuncioId\", String(list[0]?.id || \"\"));\r",
									"});\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "LivroIsbn",
									"value": "9788869183157",
									"type": "text"
								},
								{
									"key": "CategoriaId",
									"value": "{{CategoriaId}}",
									"type": "text"
								},
								{
									"key": "EstadoLivro",
									"value": "NOVO",
									"type": "text"
								},
								{
									"key": "TipoAnuncio",
									"value": "ALUGUER",
									"type": "text"
								},
								{
									"key": "Imagens",
									"type": "file",
									"src": "tests/postman/assets/book.jpeg"
								},
								{
									"key": "Preco",
									"value": "30",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Anuncio",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Anuncio"
							]
						}
					},
					"response": []
				},
				{
					"name": "Pedido",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let j = {};\r",
									"try { j = pm.response.json(); } catch (e) { j = {}; }\r",
									"\r",
									"const setVar = (k, v) => {\r",
									"  pm.environment.set(k, v);\r",
									"  pm.collectionVariables.set(k, v);\r",
									"};\r",
									"\r",
									"if (j.pedidoId != null)   setVar(\"PedidoId\",   String(j.pedidoId));\r",
									"if (j.conversaId != null) setVar(\"ConversaId\", String(j.conversaId));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"valorProposto\": \"30\",\r\n    \"anuncioId\": {{AnuncioId}},\r\n    \"diasDeAluguel\": 20\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/PedidoTransacao",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"PedidoTransacao"
							]
						}
					},
					"response": []
				},
				{
					"name": "AceitarPedido",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200 OK\", () => pm.expect(pm.response.code).to.equal(200));\r",
									"\r",
									"pm.test(\"Content-Type é JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"valorProposto\": \"30\",\r\n    \"anuncioId\": {{AnuncioId}}\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/PedidoTransacao/{{PedidoId}}/aceitar",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"PedidoTransacao",
								"{{PedidoId}}",
								"aceitar"
							]
						}
					},
					"response": []
				},
				{
					"name": "CriarTransacao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar transação 200/201\", () => {\r",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);\r",
									"});\r",
									"\r",
									"const transacao = pm.response.json().transacao;\r",
									"pm.environment.set(\"TransacaoId\", transacao.id);\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"pedidoId\": {{PedidoId}},\r\n    \"pontosUsados\": 0\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Transacao",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Transacao"
							]
						}
					},
					"response": []
				},
				{
					"name": "RegistarDevolucao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/Transacao/devolucao/{{TransacaoId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Transacao",
								"devolucao",
								"{{TransacaoId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "ConfirmarDevolucao",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/Transacao/devolucao/confirmar/{{TransacaoId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Transacao",
								"devolucao",
								"confirmar",
								"{{TransacaoId}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Conversa",
			"item": [
				{
					"name": "CriarNovoAnuncioConversa",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Criar anúncio 200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"\r",
									"const f = pm.request.body.formdata?.all?.() || [];\r",
									"const isbn = (f.find(x => x.key === \"LivroIsbn\") || {}).value || pm.environment.get(\"LivroIsbn\");\r",
									"\r",
									"pm.environment.set(\"LivroIsbn\", String(isbn)); \r",
									"\r",
									"pm.sendRequest({\r",
									"  url: `${pm.environment.get(\"baseUrl\")}/api/Anuncio?livroIsbn=${encodeURIComponent(isbn)}`,\r",
									"  method: \"GET\",\r",
									"  header: { Authorization: `Bearer ${pm.environment.get(\"TOKEN\") || \"\"}` }\r",
									"}, (_, res) => {\r",
									"  const list = (res.json().anuncios || res.json() || []);\r",
									"  list.sort((a,b) => (Date.parse(b.dataCriacao||0) - Date.parse(a.dataCriacao||0)) || ((b.id||0) - (a.id||0)));\r",
									"  pm.environment.set(\"AnuncioId\", String(list[0]?.id || \"\"));\r",
									"});\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "Preco",
									"value": "20",
									"type": "text"
								},
								{
									"key": "LivroIsbn",
									"value": "9788869183157",
									"type": "text"
								},
								{
									"key": "CategoriaId",
									"value": "{{CategoriaId}}",
									"type": "text"
								},
								{
									"key": "EstadoLivro",
									"value": "NOVO",
									"type": "text"
								},
								{
									"key": "TipoAnuncio",
									"value": "VENDA",
									"type": "text"
								},
								{
									"key": "Imagens",
									"type": "file",
									"src": "tests/postman/assets/book.jpeg"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/Anuncio",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Anuncio"
							]
						}
					},
					"response": []
				},
				{
					"name": "EnviarMensagem",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"EnviarMensagem 200 OK\", () => {\r",
									"  pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"const response = pm.response.json();\r",
									"\r",
									"pm.environment.set(\"CONVERSA_ID\", response.conversaId);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"anuncioId\": {{AnuncioId}},\r\n  \"conteudo\": \"string\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/Chat/EnviarMensagem",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Chat",
								"EnviarMensagem"
							]
						}
					},
					"response": []
				},
				{
					"name": "ObterConversas",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"\", () => {\r",
									"  pm.response.to.have.status(200);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"anuncioId\": {{AnuncioId}},\r\n  \"conteudo\": \"string\"\r\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/Chat/conversas",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Chat",
								"conversas"
							]
						}
					},
					"response": []
				},
				{
					"name": "ObterConversa",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"\", () => {\r",
									"  pm.response.to.have.status(200);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN2}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/Chat/{{CONVERSA_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Chat",
								"{{CONVERSA_ID}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Notificacao",
			"item": [
				{
					"name": "VerEstadoPreferencia",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"\", () => {\r",
									"  pm.response.to.have.status(200);\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/Notificacao/preferencias",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Notificacao",
								"preferencias"
							]
						}
					},
					"response": []
				},
				{
					"name": "New Request",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"\", () => {\r",
									"  pm.response.to.have.status(204);\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{TOKEN}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/Notificacao/preferencias",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"Notificacao",
								"preferencias"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"variable": [
		{
			"key": "PedidoId",
			"value": ""
		},
		{
			"key": "ConversaId",
			"value": ""
		}
	]
}